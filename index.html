<script>
  let validCodes = [];

  async function loadJSON() {
    const response = await fetch("map_codes.csv");
    const data = await response.json();
    validCodes = data.codes.map(code => code.toUpperCase());
  }

  function getCodeFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('code')?.toUpperCase();
  }

  function checkCode(code = null) {
    const inputCode = code || document.getElementById('codeInput').value.toUpperCase();
    const resultDiv = document.getElementById('result');
    if (!inputCode) {
      resultDiv.innerHTML = "<div class='invalid'>❗ No code entered.</div>";
      return;
    }

    if (validCodes.includes(inputCode)) {
      resultDiv.innerHTML = `<div class='verified'>✅ Verified Map Code: ${inputCode}</div>`;
    } else {
      resultDiv.innerHTML = `<div class='invalid'>❌ Invalid or Unrecognized Code.</div>`;
    }
  }

  window.onload = async () => {
    await loadJSON();
    const code = getCodeFromURL();
    if (code) {
      document.getElementById('codeInput').value = code;
      checkCode(code);
    }
  };
</script>
