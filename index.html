<script>
  let validCodes = [];

  // Load CSV and store codes
  async function loadCSV() {
    const response = await fetch("map_codes.csv");
    const text = await response.text();
    const lines = text.trim().split("\n").slice(1); // skip header
    validCodes = lines.map(line => line.trim().toUpperCase());
  }

  function getCodeFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('code')?.toUpperCase();
  }

  function checkCode(code = null) {
    const inputCode = code || document.getElementById('codeInput').value.toUpperCase();
    const resultDiv = document.getElementById('result');
    if (!inputCode) {
      resultDiv.innerHTML = "<div class='invalid'>❗ No code entered.</div>";
      return;
    }

    if (validCodes.includes(inputCode)) {
      resultDiv.innerHTML = `<div class='verified'>✅ Verified Map Code: ${inputCode}</div>`;
    } else {
      resultDiv.innerHTML = `<div class='invalid'>❌ Invalid or Unrecognized Code.</div>`;
    }
  }

  // Load CSV and auto-verify
  window.onload = async () => {
    await loadCSV();
    const code = getCodeFromURL();
    if (code) {
      document.getElementById('codeInput').value = code;
      checkCode(code);
    }
  };
</script>
